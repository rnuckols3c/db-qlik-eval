<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Results Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function ResultsDashboard() {
            const [submissions, setSubmissions] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [selectedSubmission, setSelectedSubmission] = useState(null);

            useEffect(() => {
                fetchSubmissions();
            }, []);

            const fetchSubmissions = async () => {
                try {
                    const response = await fetch('https://formspree.io/api/0/forms/xkgqyqeo/submissions', {
                        headers: {
                            'Accept': 'application/json',
                            'Authorization': 'Bearer ba284415ed9d244092a65483d0f50246996fd5b1'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`Failed to fetch submissions: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    setSubmissions(data.submissions || []);
                    setLoading(false);
                } catch (err) {
                    setError(err.message);
                    setLoading(false);
                }
            };

            const calculateAverages = () => {
                if (submissions.length === 0) return { db: 0, qlik: 0 };
                
                const totals = submissions.reduce((acc, sub) => {
                    const dbScore = parseFloat(sub.final_scores?.databricks || 0);
                    const qlikScore = parseFloat(sub.final_scores?.qlik || 0);
                    return {
                        db: acc.db + dbScore,
                        qlik: acc.qlik + qlikScore
                    };
                }, { db: 0, qlik: 0 });

                return {
                    db: (totals.db / submissions.length).toFixed(2),
                    qlik: (totals.qlik / submissions.length).toFixed(2)
                };
            };

            const averages = calculateAverages();

            if (loading) {
                return (
                    <div className="w-full max-w-7xl mx-auto p-6">
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
                            <div className="text-gray-600">Loading submissions...</div>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="w-full max-w-7xl mx-auto p-6">
                        <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                            <h2 className="text-xl font-bold text-red-900 mb-2">Error Loading Data</h2>
                            <p className="text-red-700">{error}</p>
                            <button 
                                onClick={fetchSubmissions}
                                className="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="w-full max-w-7xl mx-auto p-6">
                    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-900 mb-2">Evaluation Results Dashboard</h1>
                                <p className="text-gray-600">Databricks vs Qlik - Response Summary</p>
                            </div>
                            <button 
                                onClick={fetchSubmissions}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                            >
                                Refresh Data
                            </button>
                        </div>

                        <div className="grid grid-cols-3 gap-6 mb-6">
                            <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div className="text-sm text-gray-600 mb-1">Total Responses</div>
                                <div className="text-4xl font-bold text-gray-900">{submissions.length}</div>
                            </div>
                            <div className="bg-blue-50 p-4 rounded-lg border-2" style={{borderColor: '#2563EB'}}>
                                <div className="text-sm text-gray-600 mb-1">Average DB Score</div>
                                <div className="text-4xl font-bold" style={{color: '#2563EB'}}>{averages.db}</div>
                                <div className="text-sm text-gray-500 mt-1">out of 10.0</div>
                            </div>
                            <div className="bg-blue-50 p-4 rounded-lg border-2" style={{borderColor: '#60A5FA'}}>
                                <div className="text-sm text-gray-600 mb-1">Average Qlik Score</div>
                                <div className="text-4xl font-bold" style={{color: '#1E40AF'}}>{averages.qlik}</div>
                                <div className="text-sm text-gray-500 mt-1">out of 10.0</div>
                            </div>
                        </div>

                        {submissions.length === 0 ? (
                            <div className="text-center py-12 text-gray-500">
                                No submissions yet. Share your evaluation form to start collecting responses!
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b-2 border-gray-300 bg-gray-50">
                                            <th className="text-left py-3 px-4 font-semibold text-gray-700">Name</th>
                                            <th className="text-left py-3 px-4 font-semibold text-gray-700">Email</th>
                                            <th className="text-center py-3 px-4 font-semibold" style={{color: '#2563EB'}}>DB Score</th>
                                            <th className="text-center py-3 px-4 font-semibold" style={{color: '#1E40AF'}}>Qlik Score</th>
                                            <th className="text-center py-3 px-4 font-semibold text-gray-700">Date</th>
                                            <th className="text-center py-3 px-4 font-semibold text-gray-700">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {submissions.map((submission, idx) => {
                                            const dbScore = parseFloat(submission.final_scores?.databricks || 0);
                                            const qlikScore = parseFloat(submission.final_scores?.qlik || 0);
                                            const date = new Date(submission.submission_date || submission._date).toLocaleDateString();
                                            
                                            return (
                                                <tr key={idx} className="border-b border-gray-200 hover:bg-gray-50">
                                                    <td className="py-3 px-4 text-gray-900">{submission.submitter_name}</td>
                                                    <td className="py-3 px-4 text-gray-600">{submission.submitter_email}</td>
                                                    <td className="py-3 px-4 text-center font-semibold" style={{color: '#2563EB'}}>{dbScore.toFixed(2)}</td>
                                                    <td className="py-3 px-4 text-center font-semibold" style={{color: '#1E40AF'}}>{qlikScore.toFixed(2)}</td>
                                                    <td className="py-3 px-4 text-center text-gray-600 text-sm">{date}</td>
                                                    <td className="py-3 px-4 text-center">
                                                        <button
                                                            onClick={() => setSelectedSubmission(submission)}
                                                            className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
                                                        >
                                                            View Details
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    {selectedSubmission && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="bg-white rounded-lg shadow-xl max-w-6xl w-full p-6 my-8 max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-900">{selectedSubmission.submitter_name}'s Evaluation</h2>
                                        <p className="text-gray-600">{selectedSubmission.submitter_email}</p>
                                    </div>
                                    <button
                                        onClick={() => setSelectedSubmission(null)}
                                        className="text-gray-500 hover:text-gray-700 text-3xl font-bold leading-none"
                                    >
                                        ×
                                    </button>
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-blue-50 p-4 rounded-lg border" style={{borderColor: '#2563EB'}}>
                                        <div className="text-sm text-gray-600 mb-1">Databricks Score</div>
                                        <div className="text-3xl font-bold" style={{color: '#2563EB'}}>
                                            {parseFloat(selectedSubmission.final_scores?.databricks || 0).toFixed(2)}
                                        </div>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg border" style={{borderColor: '#60A5FA'}}>
                                        <div className="text-sm text-gray-600 mb-1">Qlik Score</div>
                                        <div className="text-3xl font-bold" style={{color: '#1E40AF'}}>
                                            {parseFloat(selectedSubmission.final_scores?.qlik || 0).toFixed(2)}
                                        </div>
                                    </div>
                                </div>

                                <h3 className="text-lg font-semibold text-gray-900 mb-3">Category Results</h3>
                                <div className="overflow-x-auto mb-6">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b-2 border-gray-300 bg-gray-50">
                                                <th className="text-left py-2 px-3 font-semibold text-gray-700">Category</th>
                                                <th className="text-center py-2 px-3 font-semibold text-gray-700">Multiplier</th>
                                                <th className="text-center py-2 px-3 font-semibold" style={{color: '#2563EB'}}>DB Avg</th>
                                                <th className="text-center py-2 px-3 font-semibold" style={{color: '#1E40AF'}}>Qlik Avg</th>
                                                <th className="text-center py-2 px-3 font-semibold" style={{color: '#2563EB'}}>DB Weighted</th>
                                                <th className="text-center py-2 px-3 font-semibold" style={{color: '#1E40AF'}}>Qlik Weighted</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(selectedSubmission.category_results || []).map((cat, idx) => (
                                                <tr key={idx} className="border-b border-gray-200">
                                                    <td className="py-2 px-3 text-gray-900">{cat.category}</td>
                                                    <td className="py-2 px-3 text-center text-gray-600">{cat.multiplier}×</td>
                                                    <td className="py-2 px-3 text-center" style={{color: '#2563EB'}}>{cat.databricks_avg}</td>
                                                    <td className="py-2 px-3 text-center" style={{color: '#1E40AF'}}>{cat.qlik_avg}</td>
                                                    <td className="py-2 px-3 text-center font-semibold" style={{color: '#2563EB'}}>{cat.databricks_weighted}</td>
                                                    <td className="py-2 px-3 text-center font-semibold" style={{color: '#1E40AF'}}>{cat.qlik_weighted}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>

                                <h3 className="text-lg font-semibold text-gray-900 mb-3">Detailed Feature Scores</h3>
                                <div className="space-y-4">
                                    {(selectedSubmission.detailed_scores || []).map((category, catIdx) => (
                                        <div key={catIdx} className="border border-gray-200 rounded-lg p-4">
                                            <h4 className="font-semibold text-gray-900 mb-2">{category.category}</h4>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-xs">
                                                    <thead>
                                                        <tr className="border-b border-gray-300 bg-gray-50">
                                                            <th className="text-left py-1 px-2 font-semibold text-gray-700">Feature</th>
                                                            <th className="text-center py-1 px-2 font-semibold text-gray-700">Weight</th>
                                                            <th className="text-center py-1 px-2 font-semibold" style={{color: '#2563EB'}}>DB</th>
                                                            <th className="text-center py-1 px-2 font-semibold" style={{color: '#1E40AF'}}>Qlik</th>
                                                            <th className="text-left py-1 px-2 font-semibold text-gray-700">Notes</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {category.items.map((item, itemIdx) => (
                                                            <tr key={itemIdx} className="border-b border-gray-100">
                                                                <td className="py-1 px-2 text-gray-900">{item.feature}</td>
                                                                <td className="py-1 px-2 text-center text-gray-600">{item.weight}</td>
                                                                <td className="py-1 px-2 text-center font-semibold" style={{color: '#2563EB'}}>{item.databricks_score}</td>
                                                                <td className="py-1 px-2 text-center font-semibold" style={{color: '#1E40AF'}}>{item.qlik_score}</td>
                                                                <td className="py-1 px-2 text-gray-600 text-xs">{item.notes}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-6 flex justify-end">
                                    <button
                                        onClick={() => setSelectedSubmission(null)}
                                        className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ResultsDashboard />);
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
